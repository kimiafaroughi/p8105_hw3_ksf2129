---
title: "p8105_hw3_ksf2129"
author: "Kimia Faroughi"
date: "2025-10-08"
output: github_document
---

## Problem 1

**Load the dataset**

```{r setup, message = FALSE}
library(tidyverse)
library(p8105.datasets)
data("instacart")

#global ggplot settings
#knitr::opts_chunk$set(
  #fig.width = 8,
  #fig.asp = .6,
  #out.width = "90%"
#)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

There are `r nrow(instacart)` rows (observations) and `r ncol(instacart)` columns (variables) in the `instacart` dataset. Each row in the dataset is a unique product from an order from instacart. Variable names in this dataset include: `r names(instacart)`. Some variables of note are `product_id` (the product identifier), `user_id` (the customer identifier), `product_name` (name of the product ordered), `aisle` (name of the aisle the product is in), and `department` (name of the department the product is in). For example, for the product `49302` and customer `112108`, the product ordered was `Bulgarian Yogurt`, which was in the `dairy eggs` department in the `yogurt` aisle.

**Explore dataset further**

There are `r instacart |> select(aisle) |> unique() |> nrow()` different (unique) aisles in the dataset. 

```{r}
instacart |> 
  group_by(aisle) |> 
  summarize(
    n = n() #gives number of obs
  ) |> 
  arrange(desc(n))
```

The most items are ordered from the fresh vegetables and fresh fruits aisles, followed by the packaged vegetables fruits, yogurt, and packaged cheese aisles.

**Plot showing the number of items ordered in each aisle, limited to aisles with more than 10000 items ordered:**

```{r, fig.height = 8, fig.width = 12}
instacart |> 
  group_by(aisle) |> 
  summarize(
    n = n()
  ) |> 
  filter(n > 10000) |> 
  arrange(desc(n)) |> 
  mutate(aisle = fct_inorder(aisle)) |> #put aisle in order of how it appears in data
  ggplot(aes(x = aisle, y = n)) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(
    x = "Aisle",
    y = "Number of Items",
    title = "Number of Items Ordered in Each Aisle"
  )
```

**Table showing 3 most popular items per aisle:**

```{r}
instacart |> 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) |> 
  group_by(aisle, product_name) |> 
  summarize(
    times_ordered = n()
  ) |>
  arrange(aisle, desc(times_ordered)) |> 
  mutate(product_rank = min_rank(-times_ordered)) |> #ranks by max amount
  filter(product_rank < 4) |> 
  select(-product_rank) |> 
  knitr::kable()
```

**Table showing mean hour of day at which pink lady apples and coffee ice cream are ordered on each day of the week:**

```{r}
instacart |> 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) |> 
  group_by(product_name, order_dow) |> 
  summarize(mean_hour = mean(order_hour_of_day)) |> 
  pivot_wider(
    names_from = product_name,
    values_from = mean_hour
  ) |> 
  select(-order_dow) |> 
  knitr::kable(digits = 2)
```

## Problem 2

**Clean and tidy the Zillow datasets**

```{r}
zip_codes_df =
  read_csv("zillow_data/Zip Codes.csv") |> 
  janitor::clean_names() |> 
  relocate(zip_code, county, neighborhood) #puts zip code, county, and neighborhood at the front

zip_zori_df =
  read_csv("zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = x2015_01_31:x2024_08_31,
    names_to = "date",
    values_to = "rent",
    names_prefix = "x" #deletes prefix string from each name value
  ) |> #put vars representing each date into its own var with another var corresponding to rent prices
  separate(
    date, into = c("year", "month", "day"), sep = "_", convert = TRUE
  ) |> #separate date into year, month, and day
  rename(zip_code = region_name, county = county_name) |> 
  mutate(county = str_remove(county, " County")) |> #deletes suffix string from each value
  relocate(zip_code, county, month, day, year, rent) #puts zip code, county, month, day, year, and rent at the front

#merge datasets
zillow_tidy =
  left_join(zip_zori_df, zip_codes_df, by = c("zip_code", "county")) |> 
  relocate(zip_code, neighborhood, county, month, day, year, rent) |> 
  mutate(zip_code = as.character(zip_code)) #convert zip code to character var
```

`r zillow_tidy |> group_by(zip_code) |> summarize(count = n()) |> filter(count == 116) |> unique() |> nrow()` zip codes are observed 116 times. 

```{r}
#how many zip codes are observed 116
zillow_tidy |> 
  group_by(zip_code) |> 
  summarize(count = n()) |> 
  filter(count == 116) |> 
  unique() |> 
  nrow()

#how many zip codes are observed < 10 times
zillow_tidy |> 
  group_by(zip_code) |> 
  summarize(count = n()) |> 
  filter(count < 10) |> 
  unique() |> 
  nrow()
```




